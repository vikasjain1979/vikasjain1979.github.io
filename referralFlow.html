<!DOCTYPE html>
<html>
<head>
	 <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Branch Referral Flow on Web</title>
  <script>
  
    // load Branch
    (function(b,r,a,n,c,h,_,s,d,k){if(!b[n]||!b[n]._q){for(;s<_.length;)c(h,_[s++]);d=r.createElement(a);d.async=1;d.src="https://cdn.branch.io/branch-latest.min.js";k=r.getElementsByTagName(a)[0];k.parentNode.insertBefore(d,k);b[n]=h}})(window,document,"script","branch",function(b,r){b[r]=function(){b._q.push([r,arguments])}},{_q:[],_v:1},"addListener applyCode autoAppIndex banner closeBanner closeJourney creditHistory credits data deepview deepviewCta first getCode init link logout redeem referrals removeListener sendSMS setBranchViewData setIdentity track validateCode trackCommerceEvent logEvent disableTracking".split(" "), 0);
    // init Branch
    // branch.init('key_live_jl1s6ftuDpPrMM1uN6Dekacgqshcyl2S');
	// branch.setBranchViewData({~channel: window.location.href});
	  
  branch.init('key_live_jl1s6ftuDpPrMM1uN6Dekacgqshcyl2S', options, function(err, data) {
  // Set view data for Journey
  branch.setBranchViewData({
    channel: window.location.href
  });
});

	  function generateBranchLink() {
		  alert('Generate Link');
		  var linkData = {
		  campaign: 'content 123',
 		  channel: 'facebook',
  		  feature: 'dashboard',
		  stage: 'new user',
		  tags: [ 'tag1', 'tag2', 'tag3' ],
		  alias: '',
		  data: {
		    'custom_bool': true,
		    'custom_int': Date.now(),
		    'custom_string': 'hello',
		    '$og_title': 'Title',
		    '$og_description': 'Description',
		    '$og_image_url':'http://lorempixel.com/400/400'
		  }
		};

	branch.link(linkData, function(err, link) {
		triggerNativeShare(link)
	});
}

	function triggerNativeShare(urlToShare) {
		alert("Invoking share sheet on native");

		Android.showToast(urlToShare);
		
	    // 1. Check if the native message handler exists (only true inside your WKWebView)
	    if (window.webkit && window.webkit.messageHandlers && window.webkit.messageHandlers.nativeProcess) {
	        
	        // 2. Post the message, sending the data as a JSON object
	        window.webkit.messageHandlers.nativeProcess.postMessage({
	            "action": "share",
	            "url": urlToShare,
	            "title": "Native Share"
	        });
	        
	    } else {
	        // Fallback for when the page is viewed outside the native app (e.g., in Safari)
	        console.log("Native share handler not found. Falling back to web share API or clipboard.");
	        
	        // Optionally use the Web Share API as a fallback for Safari/Chrome on iOS
	        if (navigator.share) {
	            navigator.share({
	                title: "Web Share",
	                url: urlToShare
	            });
	        }
	    }
	}

	</script>
</head>
<body>
<h1>Branch Referral Flow on Web - v1102.1.1 </h1>

<div class="button-container">    
	<button onclick="generateBranchLink()">Refer a Friend</button>
</div> 
</body>
</html>
